<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ========== META ========== -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>$TREATZ ‚Äî The Official Halloween Candy of Solana</title>
  <meta name="description" content="$TREATZ ‚Äî Trick-or-Treat coin toss & Jackpot Raffle. Spooky season on Solana." />
  <meta name="theme-color" content="#0D0D0D" />
  <meta property="og:title" content="$TREATZ ‚Äî The Official Halloween Candy of Solana">
  <meta property="og:description" content="Trick-or-Treat coin toss, Jack‚Äôo‚ÄôLantern Jackpot, and the Wheel of Fate. Spooky season on Solana.">
  <meta property="og:image" content="/static/assets/og_treatz.png">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
 
   <!-- ========== FAVICON ========== -->
  <link rel="icon" type="image/png" href="/static/assets/favicon.png" sizes="512x512" />
  <link rel="apple-touch-icon" href="/static/assets/favicon.png" />
  
  <!-- ========== FONTS (unchanged) ========== -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Creepster&display=swap" rel="stylesheet">

  <!-- ========== CSS (predictable + pull hashed from Vite manifest) ========== -->
 <link rel="stylesheet" href="/static/style.css?v=__BUILD__">

  <!-- ========== CONFIG (kept as-is so app.js can read) ========== -->
  <script>
    window.__TREATZ_DEBUG = false;
    window.TREATZ_BUILD = "d7ac495";
    window.TREATZ_CONFIG = {
      apiBase: "/api",
      /* rpcUrl intentionally omitted so the app will use /api/config.rpc_url
         or fall back to the local JSON-RPC proxy at /api/cluster */
      token: { symbol: "$TREATZ", decimals: 6 },
      links: {
        telegram: "https://t.me/trickortreatsol",
        twitter:  "https://x.com/trickortreatsol?s=21",
        tiktok:   "https://www.tiktok.com/@sol_treatz",
        whitepaper: "/static/whitepaper.html"
      },
      buyUrl: "https://pump.fun/coin/DqABdJvc7pELo4Qf9UbxcvNuf9CVQkKzSMtWdiWcpump",
      tokenAddress: "DqABdJvc7pELo4Qf9UbxcvNuf9CVQkKzSMtWdiWcpump",
      assets: {
        ambient: "/static/assets/ambient_loop.mp3",
        logo: "/static/assets/TREATZ_Logo.png",
        mascot: "/static/assets/Mascot.png"
      }
    };
  </script>
</head>
<body>

  <!-- (FX) Ambient music + toggle lives elsewhere; this is just the element -->
  <audio id="bg-ambient" data-src="/static/assets/ambient_loop.mp3"></audio>

  <!-- 1) TOP BANNER -->
  <div class="brand-banner">
    <img src="/static/assets/Banner_Top.png" alt="$TREATZ banner" decoding="async" fetchpriority="low" />
  </div>

  <!-- 2) HALLOWEEN COUNTDOWN BANNER -->
  <div class="countdown" id="countdown" aria-live="polite">
    <div class="countdown__inner">
      <img id="countdown-logo" class="countdown__logo" src="/static/assets/TREATZ_Logo.png" alt="$TREATZ logo" decoding="async" />
      <span class="countdown__label">‚è≥ Countdown to Halloween:</span>
      <span class="countdown__timer" id="countdown-timer">--d --h --m --s</span>
    </div>
    <div class="countdown__inner">
      <span class="countdown__omen" id="countdown-omen"></span>
    </div>
  </div>

  <!-- === SITE HEADER (title + nav) === -->
  <header class="nav" aria-label="Site header">
    <!-- Title above the nav chips -->
    <div class="site-title">
      <h1 class="treatz-title">
        <span class="treatz-symbol">$</span><span class="treatz-text">TREATZ</span>
        <span class="treatz-sub">‚Äî The Official Halloween Candy of Solana</span>
      </h1>
    </div>

    <!-- Nav chips row -->
    <div class="nav__wrap">
      <a href="/" class="nav__brand" aria-label="$TREATZ Home">
        <img src="/static/assets/TREATZ_Logo.png" alt="$TREATZ logo" height="44" decoding="async" />
        <span class="nav__brand-text">Home</span>
      </a>

      <nav class="nav__links" aria-label="Primary">
        <a href="#about" id="link-about">About</a>
        <a href="#" id="link-twitter"   target="_blank" rel="noopener">Twitter / X</a>
        <a href="#" id="link-telegram"  target="_blank" rel="noopener">Telegram</a>
        <a href="#" id="link-tiktok"    target="_blank" rel="noopener">TikTok</a>
        <a href="/static/whitepaper.html" id="link-whitepaper" target="_blank" rel="noopener">Whitepaper</a>
        <a href="#" class="nav__link--disabled" id="link-nft" aria-disabled="true" title="Coming soon">NFT</a>
        <a id="btn-open-in-phantom" href="#" target="_blank" rel="noopener" hidden>Open in Phantom</a>
      </nav>
    </div>
  </header>

  <!-- === TOKEN / BUY BAR (separate, below nav) === -->
  <div class="tokenbar" role="group" aria-label="Token & Buy">
    <div class="tokenbar__address">
      <span class="tokenbar__label">Token:</span>
      <code id="token-address">‚Äî</code>
      <button class="btn btn--ghost" id="btn-copy" type="button">Copy</button>
    </div>

    <div class="tokenbar__balance" id="wallet-balance-wrap">
      <span class="tokenbar__label">$TREATZ Balance:</span>
      <b id="wallet-balance">‚Äî</b>
    </div>

    <div class="tokenbar__actions">
      <a class="btn btn--buy" id="btn-buy" href="#" target="_blank" rel="noopener">Buy on Pump.fun</a>
    </div>
  </div>
  
  <!-- Background art layer -->
  <div class="bg" role="img" aria-label="Spooky cosmic candy background"></div>

  <main class="main">

    <!-- 5) COIN TOSS HEADER -->
    <section class="section" id="coin-flip" aria-labelledby="coinflip-title">
      <h2 class="section__title" id="coinflip-title">üéÉ Trickz or $TREATZ ‚Äî Coin Flip</h2>

      <!-- 6) SCROLLING MOCK WINS/LOSSES BANNER -->
      <div class="ticker" id="fomo-ticker" aria-live="polite">
        <div class="ticker__rail" id="ticker-rail"></div>
      </div>

      <div class="card grid-2" style="margin-top:.9rem">
        <!-- LEFT: FORM + 7) CONNECT (disabled for now) -->
        <div class="card__col">
          <div class="help" style="margin-bottom:.5rem;">
            <strong>Fairness:</strong> Seed commit/reveal ‚Ä¢ Multiplier <b id="cf-mult">2x</b> ‚Ä¢ Vault coverage <b id="vault-amount">‚Äî</b> $TREATZ
            <br><em id="cf-biggest">Biggest win: ‚Äî</em>
          </div>

          <div class="wallet wallet--inline" style="margin:.4rem 0 .6rem">
            <button class="btn btn--primary" id="btn-connect" type="button" title="Connect your wallet">Connect Wallet</button>
            <a id="btn-open-in-phantom-2" class="btn btn--ghost" href="#" target="_blank" rel="noopener" hidden>Open in Phantom</a>
          </div>

          <!-- 8) GAME UI CARD AREA (form) -->
          <form class="form" id="bet-form" autocomplete="off">
            <label class="label" for="bet-amount">Wager Amount ($TREATZ)</label>
            <input id="bet-amount" name="amount" type="number" min="0" step="1" placeholder="10,000" inputmode="numeric" />

            <span class="label" id="side-label">Pick a side</span>
            <div class="choices" role="radiogroup" aria-labelledby="side-label">
              <label class="choice"><input type="radio" name="side" value="TRICK" checked> TRICKZ üëª</label>
              <label class="choice"><input type="radio" name="side" value="TREAT"> TREATZ üç¨</label>
            </div>

            <button id="cf-play" type="button" class="btn btn--primary btn--flip">Flip Now</button>

            <p class="help" id="edge-line">House edge & on-chain fairness info appears here.</p>

            <!-- Optional fields app.js may populate -->
            <div class="help" id="bet-instructions" style="margin-top:.5rem;">
              <div><strong>Deposit:</strong> <code id="bet-deposit">‚Äî</code></div>
              <div><strong>Memo:</strong> <code id="bet-memo">‚Äî</code></div>
            </div>
          </form>
        </div>

        <!-- RIGHT: COIN + STATUS (FX will hook to #fx-layer) -->
        <div class="card__col">
          <div class="cf-display" id="cf-display" aria-live="polite">
            <div class="coin" id="coin" role="img" aria-label="Coin showing TRICK or TREAT">
              <div class="coin__face coin__face--front">TRICK</div>
              <div class="coin__face coin__face--back">TREAT</div>
            </div>

            <!-- centered win/loss banner -->
            <div id="cf-banner" class="cf-banner" aria-live="polite"></div>

            <div class="cf-status" id="cf-status">Ready to flip.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- 9) JACKPOT HEADER -->
    <section class="section" id="jackpot" aria-labelledby="jackpot-title">
      <h2 class="section__title" id="jackpot-title">üïØÔ∏è üéÉ Jack'O'Lantern Jackpot Raffle üéÉ</h2>

      <div id="jackpot-card" class="card grid-3 grid-rows">
        <div class="card__col">
          <div class="stats">
            <div><span class="stat__label">Current Pot</span> <span class="stat__value"><strong id="round-pot">‚Äî</strong> $TREATZ</span></div>
            <div><span class="stat__label">Round</span> <span class="stat__value" id="round-id">‚Äî</span></div>
            <div><span class="stat__label">Closes In</span> <span class="stat__value" id="round-countdown">‚Äî</span></div>
            <div><span class="stat__label">Next Draw Starts In</span> <span class="stat__value" id="round-next-countdown">‚Äî</span></div>
            <div><span class="stat__label">Ticket Price</span> <span class="stat__value"><strong id="ticket-price">‚Äî</strong> $TREATZ</span></div>
            <div>
              <span class="stat__label">Seed</span>
              <p class="seedline stat__value">
                <span class="label">Commit:</span>
                <code id="seed-commit" class="mono break">‚Äî</code>
                <span class="sep">/</span>
                <span class="label">Reveal:</span>
                <code id="seed-reveal" class="mono break">‚Äî</code>
                <span class="muted">(salt on results)</span>
              </p>
            </div>
          </div>
          <div class="progress" aria-label="Time remaining">
            <div class="progress__bar" id="jp-progress" style="width:0%"></div>
          </div>
          <p id="raffle-schedule" class="help" style="margin-top:.5rem;">Draw cadence appears here.</p>

          <!-- Raffle heartbeat / backend status -->
          <div id="jp-heartbeat" class="jp-heartbeat" aria-live="polite">
            <span class="dot" aria-hidden="true"></span>
            <span id="jp-status" aria-live="off">Checking raffle schedule‚Ä¶</span>
          </div>

          <script>
          (function () {
            const $ = (id)=>document.getElementById(id);
            const fmt = (ms)=> {
              const sec = Math.max(0, Math.floor(ms/1000));
              return `${String(Math.floor(sec/60)).padStart(2,'0')}:${String(sec%60).padStart(2,'0')}`;
            };
            const parseIso = (s)=>{
              if(!s) return null;
              const t = String(s).trim();
              return new Date(t.endsWith('Z') ? t : t.replace(/Z?$/,'Z'));
            };

            async function tick(){
              try{
                const [hRes, cur] = await Promise.all([
                  fetch('/api/health',{cache:'no-store'}).then(r=>r.json()).catch(()=>({ok:false})),
                  fetch('/api/rounds/current',{cache:'no-store'}).then(r=>r.json())
                ]);
                const closes = parseIso(cur?.closes_at);
                const leftMs = closes ? (closes.getTime() - Date.now()) : 0;

                // inline heartbeat line
                const s = $('jp-status'); const hb = $('jp-heartbeat');
                if(s) s.textContent = `Round #${cur?.round_id ?? '‚Äî'} ‚Äî closes in ${fmt(leftMs)}`;
                if(hb) hb.classList.toggle('is-up', !!hRes.ok);

                // big ‚ÄúCloses In‚Äù stat + progress bar
                const big = $('round-countdown'); if(big) big.textContent = fmt(leftMs);
                const prog = $('jp-progress'); if(prog && cur?.open_at && closes){
                  const open = parseIso(cur.open_at)?.getTime() ?? Date.now();
                  const total = closes.getTime() - open;
                  const pct = total > 0 ? Math.max(0, Math.min(100, (1 - (leftMs/total))*100)) : 0;
                  prog.style.width = `${pct.toFixed(2)}%`;
              }
              }catch(e){
                const s = $('jp-status'); if(s) s.textContent = 'Raffle offline (backend unreachable)';
                $('jp-heartbeat')?.classList.remove('is-up');
              }
            }
            tick(); setInterval(tick, 1000);
          })();
          </script>

        </div>
       
        <!-- 10) DISABLED CONNECT + 11) BUY TICKETS -->
        <div class="card__col">
          <div class="wallet wallet--inline" style="margin-bottom:.75rem;">
            <button class="btn btn--primary" id="btn-connect-2" type="button" title="Connect your wallet">Connect Wallet</button>
            <a id="btn-open-in-phantom-3" class="btn btn--ghost" href="#" target="_blank" rel="noopener" hidden>Open in Phantom</a>
          </div>

          <div class="form">
            <label class="label" for="jp-amount">Buy Tickets</label>
            <input id="jp-amount" type="number" min="1" step="1" placeholder="1" />
            <p class="help">Total cost: <b id="jp-total">‚Äî</b> $TREATZ</p>
            <button class="btn btn--primary" id="jp-buy" type="button">Enter Raffle</button>
            <p class="help">Tickets recorded on-chain. Auto-payout to winner. % burn to incinerator.</p>
          </div>
        </div>

        <!-- 12) RECENT ROUNDS + 13) MY WALLET -->
        <div class="card__col jp__recent">
          <div class="mini-table" aria-live="polite">
            <div class="mini-table__head">
              <span>Recent Rounds</span>
              <button class="btn btn--ghost" id="jp-view-all" type="button">View All</button>
            </div>
            <ul class="mini-table__list recent-list" id="recent-rounds"></ul>
          </div>

          <div id="player-stats" class="card small" hidden style="margin-top:.75rem;">
            <div><strong>Your tickets (current round):</strong> <span id="ps-tickets">0</span></div>
            <div><strong>Ticket credit:</strong> <span id="ps-credit">0</span> $TREATZ</div>
            <div><strong>Total spent:</strong> <span id="ps-spent">0</span> $TREATZ</div>
            <div><strong>Total won:</strong> <span id="ps-won">0</span> $TREATZ</div>
          </div>
        </div>
      </div>
    </section>

    <!-- 14) ROUND SEARCH BAR + RESULTS -->
    <section class="section" id="raffle-history" aria-labelledby="raffle-history-title">
      <h2 class="section__title" id="raffle-history-title">Raffle History</h2>
      <div class="card">
        <label class="visually-hidden" for="history-search">Search round</label>
        <input id="history-search" type="text" placeholder="Search round (e.g., R1601)" />
        <div class="table-wrap" style="margin-top:.5rem;">
          <table id="history-table" class="rf-table">
            <thead><tr>
              <th>Round</th>
              <th>Pot</th>
              <th>Winner</th>
              <th>Payout Tx</th>
              <th>Server Hash</th>
              <th>Reveal</th>
              <th>Salt</th>
            </tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
    
        <!-- üïØÔ∏è WHEEL OF FATE -->
    <section class="section" id="wheel" aria-labelledby="wheel-title">
      <h2 class="section__title" id="wheel-title">üïØÔ∏è Wheel of Fate ‚Äî Spin for $TREATZ</h2>

      <div class="card grid-2 wheel-card">
        <div class="card__col">
          <div class="help">
            <strong>Provably fair:</strong> commit/reveal seed + blockhash |
            Cost: <b id="wheel-price">‚Äî</b> $TREATZ per spin
          </div>

<button id="wheel-spin" class="btn btn--primary">Spin the Wheel (<span id="wheel-price-btn">‚Äî</span>)</button>

          <!-- Wallet controls for Wheel of Fate -->
          <div class="wallet wallet--inline" style="margin:.5rem 0 .6rem">
            <button class="btn btn--primary" id="wheel-connect" type="button">Connect Wallet</button>
            <a id="wheel-open-in-phantom" class="btn btn--ghost" href="#" target="_blank" rel="noopener" hidden>Open in Phantom</a>
            <span id="wheel-addr" class="small muted" hidden></span>
          </div>

          <div class="form">
            <div class="btnrow">
              <button id="wheel-freespin" class="btn btn--ghost">Use Free Spin</button>
            </div>
            <p class="help" id="wheel-commit">Commit: ‚Äî</p>
            <div class="small muted">
              Free spins: <b id="wheel-free">0</b>
              <span id="wheel-mode" class="tag" style="margin-left:.5rem;">Simulated (no wallet)</span>
            </div>
          </div>
        </div>

        <div class="card__col">
          <div class="wheel-wrap">
            <div class="wheel-pointer">‚ñ≤</div>
            <svg id="wheel-svg" class="wheel" viewBox="0 0 400 400" role="img" aria-label="Wheel of Fate"></svg>
          </div>
          <div id="wheel-status" class="small" style="margin-top:.5rem;" aria-live="polite">Ready.</div>
        </div>
      </div>

      <div id="wheel-toast" class="card small" hidden></div>

      <!-- lightweight in-card history -->
      <div class="card small" id="wheel-history" hidden>
        <div class="muted small">Recent spins</div>
        <ul id="wheel-history-list" class="list-plain"></ul>
      </div>
    </section>

    <!-- 15) ABOUT TREATZ -->
    <section class="section" id="about" aria-labelledby="about-title">
      <h2 class="section__title" id="about-title">About $TREATZ</h2>
      <div class="card">
        <p>üéÉüç¨ <strong>$TREATZ</strong> is the <em>official (unofficially official)</em> Halloween meme coin of Solana ‚Äî bold, spooky, and made for glorious pumps. üéÉüç¨</p>
        <p>Remember that one house that gave out the <strong>good candy</strong> ‚Äî full-size bars, no raisins, no grandma toffee? That‚Äôs $TREATZ. The <em>pump-sized, sugar-rush, king-of-the-block candy</em> of Solana season. üç´‚ö°</p>
        <ul>
          <li>üßÉ <strong>Coin Flip Game</strong> ‚Äî double your $TREATZ or cry like you got raisins.</li>
          <li>üé∞ <strong>Jack‚ÄôO‚ÄôLantern Jackpot</strong> ‚Äî raffle madness and degen dopamine.</li>
          <li>üç¨ <strong>Trick or Treatz NFTs</strong> ‚Äî unwrap hidden $TREATZ, SOL, and spooky surprises.</li>
        </ul>
        <p>üî• <strong>Current Contest:</strong> Join our TG <em>$TREATZ Wrapper Meme Contest</em> ‚Äî top 2 win <strong>$25 in SOL or $TREATZ!</strong> üíÄ</p>
        <p>üï∏Ô∏è <strong>The Lore:</strong> Halloween on Solana needed a hero ‚Äî not a pumpkin rug, but a treat worth unwrapping. The <strong>best bag in the bowl</strong>. The <strong>sugar rush of meme season</strong>. The coin that makes every wallet feel like Halloween night. üéÉüç≠</p>
        <p><strong>Grab your bag. Trick or treat the chain. Only the real $TREATZ survive.</strong> üéÉüç¨</p>
      </div>
      <div class="about-backtop-wrap" aria-hidden="false">
        <button id="back-to-top" class="btn-back-to-top" aria-label="Back to top">Back to top ‚Üë</button>
      </div>
    </section>

    <!-- 16) FOOTER + LEGAL -->
    <footer class="footer">
      <p>üéÉüç¨ <strong>¬© 2025 $TREATZ</strong> ‚Äî The <em>Official (Unofficially)</em> Halloween Candy of Solana. üéÉüç¨</p>
      <p class="legal">
        ‚ö†Ô∏è Nothing here is financial advice. $TREATZ is for <strong>fun, memes, and degens</strong> ‚Äî not financial wizards.  
        Crypto‚Äôs spooky, markets go bump in the night ‚Äî play responsibly and stay sweet. üç≠
      </p>
    </footer>
    </main>

  <!-- (FX) GLOBAL RENDER LAYER + FLOATING MASCOT -->
  <div id="fx-layer" aria-hidden="true"></div>
  <img id="mascot-floater" src="/static/assets/Mascot.png" alt="Mascot" decoding="async" loading="lazy" fetchpriority="low" />

  <!-- (Wallet modal markup kept if needed later) -->
  <div id="wallet-modal" class="wm" hidden>
    <div class="wm__backdrop" data-close></div>
    <div class="wm__card" role="dialog" aria-modal="true" aria-labelledby="wm-title">
      <button class="wm__close" data-close aria-label="Close">√ó</button>
      <h3 id="wm-title">Connect a wallet</h3>
      <p class="wm__sub">Choose a provider to continue.</p>
      <div id="wallet-menu" class="wm__list">
        <button class="wm__item" data-wallet="phantom"><span class="wm__icon phantom"></span> Phantom</button>
        <button class="wm__item" data-wallet="solflare"><span class="wm__icon solflare"></span> Solflare</button>
        <button class="wm__item" data-wallet="backpack"><span class="wm__icon backpack"></span> Backpack</button>
      </div>
      <a id="btn-open-in-phantom-modal" class="wm__deeplink" href="#" target="_blank" rel="noopener" hidden>Open site in Phantom</a>
    </div>
  </div>
  <!-- If app.js uses `import` (ESM), load it as a module. Modern browsers will load and execute ESM modules. -->
  <!-- Force local API (no CORS) -->
  <script>
    if (window.TREATZ_CONFIG) window.TREATZ_CONFIG.apiBase = "/api";
  </script>
  
  <!-- Robust entry loader: try /static/app.js, else Vite manifest -->
  <script>
    (async () => {
      // 1) Prefer the hand-built bundle if present
      try {
        const head = await fetch("/static/app.js", { method: "HEAD", cache: "no-store" });
        if (head.ok) {
          const s = document.createElement("script");
          s.type = "module";
          s.src = "/static/app.js";
          document.body.appendChild(s);
          return;
        }
      } catch {}

      // 2) Fall back to Vite manifest ‚Äî only select JS entries
      const manifests = [
        "/static/manifest.json",
        "/static/.vite/manifest.json",
        "/.vite/manifest.json",
      ];

      const pickJs = (mf) => {
        const vals = Object.values(mf || {}).filter(v => v && v.file && /\.js($|\?)/i.test(v.file));
        return (vals.find(v => v.isEntry) || vals[0] || {}).file || "";
      };

      for (const m of manifests) {
        try {
          const res = await fetch(m, { cache: "no-store" });
          if (!res.ok) continue;
          const mf = await res.json();
          const main = pickJs(mf);
          if (!main) continue;

          const prefix = m.startsWith("/static/") ? "/static/" : "/";
          const s = document.createElement("script");
          s.type = "module";
          s.src = prefix + main;   // e.g. /static/assets/index-XYZ.js
          document.body.appendChild(s);
          return;
        } catch {}
      }

      console.error("[TREATZ] Failed to load entry JS from all sources");
    })();
  </script>
</body>
</html>
